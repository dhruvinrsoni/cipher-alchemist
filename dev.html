<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Cipher Alchemist - Developer Dashboard</title>
    <style>
        :root {
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --primary: #007bff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .back-to-app {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 2rem;
        }

        .quick-action-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .quick-action-btn.primary { background: var(--primary); color: white; }
        .quick-action-btn.success { background: var(--success); color: white; }
        .quick-action-btn.warning { background: var(--warning); color: black; }
        .quick-action-btn.danger { background: var(--danger); color: white; }
        .quick-action-btn.info { background: var(--info); color: white; }

        .status-overview {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: var(--light);
        }

        .status-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .status-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .test-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .test-card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .test-status.success { background: var(--success); color: white; }
        .test-status.warning { background: var(--warning); color: black; }
        .test-status.danger { background: var(--danger); color: white; }
        .test-status.info { background: var(--info); color: white; }
        .test-status.pending { background: #6c757d; color: white; }

        .test-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }        .test-results {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background: var(--light);
            min-height: 60px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }

        /* Enhanced scrollbar styling for test results */
        .test-results::-webkit-scrollbar {
            width: 8px;
        }

        .test-results::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .test-results::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }        .test-results::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Test result item styling - COPIED FROM WORKING DASHBOARD */
        .test-result-item {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            border-left: 4px solid #17a2b8;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .test-result-item.pass {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .test-result-item.fail {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .test-result-item.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }

        .test-result-item.warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        .test-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .test-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 80px;
        }

        .test-btn:hover {
            transform: translateY(-1px);
        }

        .test-btn.primary { background: var(--primary); color: white; }
        .test-btn.success { background: var(--success); color: white; }
        .test-btn.info { background: var(--info); color: white; }

        .performance-metrics {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }        }
    </style>
    
    <!-- Include notification styles and system -->
    <link rel="stylesheet" href="css/notifications.css">
</head>
<body>
    <div class="back-to-app">
        <a href="index.html" class="back-btn">üè† Back to App</a>
    </div>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>üîß Developer Dashboard</h1>
            <p>Advanced Testing & Debug Console for Cipher Alchemist</p>
        </div>        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-action-btn primary" onclick="runAllTests()">üöÄ Run All Tests</button>
            <button class="quick-action-btn success" onclick="runCoreTests()">‚ö° Core Tests</button>
            <button class="quick-action-btn warning" onclick="runPerformanceTests()">üìä Performance</button>
            <button class="quick-action-btn" onclick="runAdvancedFeatureTests()" style="background: #9b59b6;">üöÄ Advanced Features</button>
            <button class="quick-action-btn danger" onclick="clearAllResults()">üóëÔ∏è Clear Results</button>
            <button class="quick-action-btn info" onclick="openTestUrl('?phrase=DevTest123')">üîó Test URL</button>
            <button class="quick-action-btn" onclick="window.open('testlab.html', '_blank')">üß™ Test Lab</button>
            <button class="quick-action-btn" onclick="runManualAppendTest()" style="background: #ff6b6b;">üß™ Debug Test</button>
        </div>

        <!-- Status Overview -->
        <div class="status-overview">
            <h2>üìä System Status</h2>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-number" id="tests-run">0</div>
                    <div class="status-label">Tests Run</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="tests-passed">0</div>
                    <div class="status-label">Passed</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="tests-failed">0</div>
                    <div class="status-label">Failed</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="avg-time">0ms</div>
                    <div class="status-label">Avg Time</div>
                </div>
            </div>
        </div>

        <!-- Test Cards Grid -->
        <div class="test-grid">
            <!-- Password Generation Test -->
            <div class="test-card">
                <div class="test-card-header">
                    <div class="test-card-title">üîê Password Generation</div>
                    <div class="test-status pending" id="password-status">READY</div>
                </div>
                <div class="test-description">Test password transformation algorithms and URL parameter processing with real phrases</div>
                <div class="test-actions">
                    <button class="test-btn primary" onclick="testPasswordGeneration()">üîê Test</button>
                    <button class="test-btn info" onclick="openTestUrl('?phrase=TestGeneration123')">üîó Live Test</button>
                </div>
                <div class="test-results" id="password-results">Ready to test password generation...</div>
            </div>

            <!-- UI Components Test -->
            <div class="test-card">
                <div class="test-card-header">
                    <div class="test-card-title">üé® UI Components</div>
                    <div class="test-status pending" id="ui-status">READY</div>
                </div>
                <div class="test-description">Verify all UI elements are present and functional - requires phrase input for proper functionality</div>
                <div class="test-actions">
                    <button class="test-btn primary" onclick="testUIComponents()">üé® Test</button>
                    <button class="test-btn info" onclick="openTestUrl('?phrase=UITest123')">üè† Test with Phrase</button>
                </div>
                <div class="test-results" id="ui-results">Ready to test UI components...</div>
            </div>

            <!-- Sharing Feature Test -->
            <div class="test-card">
                <div class="test-card-header">
                    <div class="test-card-title">üì§ Sharing System</div>
                    <div class="test-status pending" id="sharing-status">READY</div>
                </div>
                <div class="test-description">Test sharing modal, native API, and URL generation - works best with URL parameters</div>
                <div class="test-actions">
                    <button class="test-btn primary" onclick="testSharingFeature()">üì§ Test</button>
                    <button class="test-btn info" onclick="openTestUrl('?phrase=ShareTest123')">üîó Live Share Test</button>
                </div>
                <div class="test-results" id="sharing-results">Ready to test sharing features...</div>
            </div>

            <!-- PWA Features Test -->
            <div class="test-card">
                <div class="test-card-header">
                    <div class="test-card-title">üì± PWA Features</div>
                    <div class="test-status pending" id="pwa-status">READY</div>
                </div>
                <div class="test-description">Test Progressive Web App functionality and service workers</div>
                <div class="test-actions">
                    <button class="test-btn primary" onclick="testPWAFeatures()">üì± Test</button>
                    <button class="test-btn info" onclick="openTestUrl('')">üì≤ Install Test</button>
                </div>
                <div class="test-results" id="pwa-results">Ready to test PWA features...</div>
            </div>

            <!-- Keyboard Shortcuts Test -->
            <div class="test-card">
                <div class="test-card-header">
                    <div class="test-card-title">‚å®Ô∏è Keyboard Shortcuts</div>
                    <div class="test-status pending" id="keyboard-status">READY</div>
                </div>
                <div class="test-description">Test keyboard shortcuts and help modal functionality</div>
                <div class="test-actions">
                    <button class="test-btn primary" onclick="testKeyboardShortcuts()">‚å®Ô∏è Test</button>
                    <button class="test-btn info" onclick="openTestUrl('?phrase=KeyboardTest')">üîó Live Test</button>
                </div>
                <div class="test-results" id="keyboard-results">Ready to test keyboard shortcuts...</div>
            </div>

            <!-- URL Parameters Test -->
            <div class="test-card">
                <div class="test-card-header">
                    <div class="test-card-title">üåê URL Parameters</div>
                    <div class="test-status pending" id="url-status">READY</div>
                </div>
                <div class="test-description">Test URL parameter processing and direct phrase sharing functionality</div>
                <div class="test-actions">
                    <button class="test-btn primary" onclick="testURLParameters()">üåê Test</button>
                    <button class="test-btn info" onclick="openTestUrl('?phrase=URLTest123!')">üîó Live Test</button>
                </div>
                <div class="test-results" id="url-results">Ready to test URL parameters...</div>
            </div>        </div>

        <!-- Advanced Features Section -->
        <div class="advanced-features-section">
            <!-- Removed advanced features: plugin manager, advanced search, file operations, dark mode plugin -->
        </div>

        <!-- Performance Metrics -->
        <div class="performance-metrics">
            <h3>üìà Performance Metrics</h3>
            <div class="metric-row">
                <span>Page Load Time</span>
                <span id="load-time">Measuring...</span>
            </div>
            <div class="metric-row">
                <span>JavaScript Execution</span>
                <span id="js-time">Measuring...</span>
            </div>
            <div class="metric-row">
                <span>DOM Ready Time</span>
                <span id="dom-time">Measuring...</span>
            </div>
            <div class="metric-row">
                <span>Tests Executed</span>
                <span id="test-count">0</span>
            </div>
        </div>
    </div>    <!-- Include all Cipher Alchemist scripts for testing -->    <script src="js/config.js"></script>
    <script src="js/cipher-algorithms.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/main.js"></script>
    <script src="js/password-strength.js"></script>
    <script src="js/phrase-suggestions.js"></script>
    <script src="js/keyboard-shortcuts.js"></script>
    <script src="js/sharing.js"></script>
    <script src="js/pwa.js"></script>

    <script>        // Dashboard state management
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            times: []
        };

        let testExecutionTimes = [];
        let totalTestsExecuted = 0;
        let openTestWindows = []; // Track opened windows for cleanup
        let popupBlockerDetected = false;
        
        // Track individual test results for each card
        let cardResults = {
            password: [],
            ui: [],
            sharing: [],
            pwa: [],
            keyboard: [],
            url: []
        };

        // Auto-run initial health check and tests after load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runInitialHealthCheck();
                measurePerformanceMetrics();
                
                // Auto-run all tests after a small delay
                console.log('üöÄ Auto-starting all tests in 2 seconds...');
                setTimeout(() => {
                    runAllTests();
                }, 2000);
            }, 1000);
        });

        // Popup blocker detection and handling
        function detectAndHandlePopupBlocker() {
            try {
                const testWindow = window.open('about:blank', '_blank', 'width=1,height=1');
                if (!testWindow || testWindow.closed || typeof testWindow.closed === 'undefined') {
                    popupBlockerDetected = true;
                    showPopupBlockerWarning();
                    return false;
                } else {
                    testWindow.close();
                    return true;
                }
            } catch (e) {
                popupBlockerDetected = true;
                showPopupBlockerWarning();
                return false;
            }
        }

        // Show popup blocker warning with nice UI
        function showPopupBlockerWarning() {
            if (document.getElementById('popup-warning')) return; // Already shown

            const warningDiv = document.createElement('div');
            warningDiv.id = 'popup-warning';
            warningDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                color: white;
                padding: 20px;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
                z-index: 1000;
                max-width: 400px;
                font-family: inherit;
                animation: slideIn 0.3s ease-out;
            `;

            warningDiv.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <div style="font-size: 24px;">üö´</div>
                    <div>
                        <h4 style="margin: 0 0 8px 0; font-size: 16px;">Popup Blocker Detected</h4>
                        <p style="margin: 0 0 12px 0; font-size: 14px; line-height: 1.4;">
                            Some tests require opening new windows. Please allow popups for this site to enable full testing.
                        </p>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="enablePopupsAndRetry()" style="
                                background: rgba(255,255,255,0.2);
                                border: 1px solid rgba(255,255,255,0.3);
                                color: white;
                                padding: 8px 16px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 12px;
                            ">Enable & Retry</button>
                            <button onclick="dismissPopupWarning()" style="
                                background: transparent;
                                border: 1px solid rgba(255,255,255,0.3);
                                color: white;
                                padding: 8px 16px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 12px;
                            ">Dismiss</button>
                        </div>
                    </div>
                </div>
            `;

            // Add slide-in animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(warningDiv);        }

        // Enable popups and retry tests
        function enablePopupsAndRetry() {
            dismissPopupWarning();
            modernAlert('Please allow popups in your browser settings, then click "Run All Tests" again.');
        }

        // Dismiss popup warning
        function dismissPopupWarning() {
            const warning = document.getElementById('popup-warning');
            if (warning) {
                warning.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => warning.remove(), 300);
            }
        }

        // Clean up opened test windows
        function cleanupTestWindows() {
            openTestWindows.forEach(window => {
                try {
                    if (window && !window.closed) {
                        window.close();
                    }
                } catch (e) {
                    console.warn('Could not close window:', e);
                }
            });
            openTestWindows = [];
        }

        // Enhanced window opening with management
        function openManagedTestWindow(url, testName) {
            try {
                const testWindow = window.open(url, `test_${testName}_${Date.now()}`, 'width=800,height=600');
                
                if (!testWindow || testWindow.closed || typeof testWindow.closed === 'undefined') {
                    if (!popupBlockerDetected) {
                        popupBlockerDetected = true;
                        showPopupBlockerWarning();
                    }
                    return null;
                }

                // Track window for cleanup
                openTestWindows.push(testWindow);

                // Auto-close after 3 seconds
                setTimeout(() => {
                    try {
                        if (testWindow && !testWindow.closed) {
                            testWindow.close();
                        }
                    } catch (e) {
                        console.warn('Auto-close failed:', e);
                    }
                }, 3000);

                return testWindow;
            } catch (e) {
                console.warn('Failed to open test window:', e);
                if (!popupBlockerDetected) {
                    popupBlockerDetected = true;
                    showPopupBlockerWarning();
                }
                return null;
            }
        }

        // Measure performance metrics
        function measurePerformanceMetrics() {
            try {
                const perfData = performance.getEntriesByType('navigation')[0];
                document.getElementById('load-time').textContent = `${Math.round(perfData.loadEventEnd - perfData.fetchStart)}ms`;
                document.getElementById('dom-time').textContent = `${Math.round(perfData.domContentLoadedEventEnd - perfData.fetchStart)}ms`;
                document.getElementById('js-time').textContent = `${Math.round(perfData.domContentLoadedEventEnd - perfData.responseEnd)}ms`;
            } catch (error) {
                console.warn('Performance metrics not available:', error);
            }
        }

        // Update status overview
        function updateOverview() {
            document.getElementById('tests-run').textContent = testResults.total;
            document.getElementById('tests-passed').textContent = testResults.passed;
            document.getElementById('tests-failed').textContent = testResults.failed;
            document.getElementById('test-count').textContent = totalTestsExecuted;
            
            if (testResults.times.length > 0) {
                const avgTime = testResults.times.reduce((a, b) => a + b, 0) / testResults.times.length;
                document.getElementById('avg-time').textContent = `${Math.round(avgTime)}ms`;
            }
        }        // Test execution helper - FIXED: Array-based result tracking
        function executeTest(testName, testFunction) {
            const startTime = performance.now();
            const statusElement = document.getElementById(`${testName}-status`);
            const resultsElement = document.getElementById(`${testName}-results`);
            
            statusElement.textContent = 'RUNNING';
            statusElement.className = 'test-status warning';
            
            try {
                const result = testFunction();
                const endTime = performance.now();
                const executionTime = endTime - startTime;
                
                testResults.total++;
                testResults.passed++;
                testResults.times.push(executionTime);
                totalTestsExecuted++;
                
                statusElement.textContent = 'PASSED';
                statusElement.className = 'test-status success';
                
                // Add result to the card's result array
                const timestamp = new Date().toLocaleTimeString();
                const resultEntry = {
                    timestamp: timestamp,
                    status: 'PASSED',
                    message: result,
                    executionTime: Math.round(executionTime)
                };
                
                // Initialize array if it doesn't exist
                if (!cardResults[testName]) {
                    cardResults[testName] = [];
                }
                
                cardResults[testName].push(resultEntry);
                
                // Update the display with all results for this card
                updateCardResultsDisplay(testName);
                
            } catch (error) {
                const endTime = performance.now();
                const executionTime = endTime - startTime;
                
                testResults.total++;
                testResults.failed++;
                testResults.times.push(executionTime);
                totalTestsExecuted++;
                
                statusElement.textContent = 'FAILED';
                statusElement.className = 'test-status danger';
                
                // Add error result to the card's result array
                const timestamp = new Date().toLocaleTimeString();
                const resultEntry = {
                    timestamp: timestamp,
                    status: 'FAILED',
                    message: error.message,
                    executionTime: Math.round(executionTime)
                };
                
                // Initialize array if it doesn't exist
                if (!cardResults[testName]) {
                    cardResults[testName] = [];
                }
                
                cardResults[testName].push(resultEntry);
                
                // Update the display with all results for this card
                updateCardResultsDisplay(testName);
            }
            
            updateOverview();
        }        // Function to update the display for a specific card's results - FIXED: Using DOM approach
        function updateCardResultsDisplay(testName) {
            const resultsElement = document.getElementById(`${testName}-results`);
            console.log(`üîç Updating display for ${testName}:`, {
                elementFound: !!resultsElement,
                elementId: `${testName}-results`,
                resultCount: cardResults[testName] ? cardResults[testName].length : 0
            });
            
            if (!resultsElement || !cardResults[testName]) {
                console.warn(`‚ùå Missing element or results for ${testName}`);
                return;
            }
            
            // FIXED: Clear and rebuild using DOM elements (like the working dashboard)
            resultsElement.innerHTML = ''; // Clear existing content
            
            // Add each result as a separate DOM element
            cardResults[testName].forEach((entry, index) => {
                const resultDiv = document.createElement('div');
                
                // Map our status to the dashboard's status format
                const dashboardStatus = entry.status === 'PASSED' ? 'pass' : 'fail';
                resultDiv.className = `test-result-item ${dashboardStatus}`;
                
                // Format the content like the working dashboard
                const icon = entry.status === 'PASSED' ? '‚úÖ' : '‚ùå';
                const prefix = entry.status === 'PASSED' ? '' : 'Error: ';
                resultDiv.innerHTML = `[${entry.timestamp}] ${icon} ${prefix}${entry.message}<br><small>Execution time: ${entry.executionTime}ms</small>`;
                
                // Append the element (this is the key difference!)
                resultsElement.appendChild(resultDiv);
                
                console.log(`ÔøΩ Added result ${index + 1} as DOM element:`, entry);
            });
            
            // Auto-scroll to bottom to show latest result
            resultsElement.scrollTop = resultsElement.scrollHeight;
            
            console.log(`üìù Updated ${testName} results display with ${cardResults[testName].length} DOM elements`);
        }// Individual test functions with proper URL parameter understanding and window management
        function testPasswordGeneration() {
            return executeTest('password', () => {
                // Test in context - open window with phrase parameter
                const testPhrase = 'TestGeneration123';
                const testWindow = openManagedTestWindow(`index.html?phrase=${encodeURIComponent(testPhrase)}`, 'password');
                
                // Test cipher algorithms that actually exist in the app
                if (typeof applyCipherTransform !== 'function') {
                    throw new Error('applyCipherTransform function not available');
                }
                
                if (typeof substitutions !== 'object') {
                    throw new Error('Substitutions mapping not available');
                }
                
                // Test basic transformations using the real cipher function
                const testStr = 'Test123';
                const cipherResult = applyCipherTransform(testStr);
                
                if (!cipherResult || !cipherResult.password) {
                    throw new Error('Cipher transformation returned empty results');
                }
                
                // Test individual character substitutions
                const testA = substitutions['a'] || 'a';
                const testE = substitutions['e'] || 'e';
                const test1 = substitutions['1'] || '1';
                
                const windowStatus = testWindow ? 'opened (auto-closing in 3s)' : 'blocked by popup blocker';
                return `Cipher transformation working. "${testStr}" ‚Üí "${cipherResult.password}". Sample substitutions: a‚Üí${testA}, e‚Üí${testE}, 1‚Üí${test1}. Live test ${windowStatus}.`;
            });
        }

        function testURLParameters() {
            return executeTest('url', () => {
                // Test URL parameter processing by checking if the app handles URL params
                const testPhrase = 'URLTest123';
                const testWindow = openManagedTestWindow(`index.html?phrase=${encodeURIComponent(testPhrase)}`, 'url');
                
                // Test URL parsing functionality
                const testParams = new URLSearchParams('?phrase=TestPhrase123&other=value');
                const phrase = testParams.get('phrase');
                
                if (phrase !== 'TestPhrase123') {
                    throw new Error('URL parameter parsing failed');
                }
                
                const windowStatus = testWindow ? 'opened (auto-closing in 3s)' : 'blocked by popup blocker';
                return `URL parameter processing verified. Test phrase: "${phrase}". Live test ${windowStatus}.`;
            });
        }

        function testSharingFeature() {
            return executeTest('sharing', () => {
                // Test sharing API availability
                const hasNativeShare = typeof navigator.share === 'function';
                const hasClipboard = typeof navigator.clipboard === 'object';
                
                // Test share URL generation
                const testPhrase = 'ShareTest123';
                const shareURL = `${window.location.origin}/index.html?phrase=${encodeURIComponent(testPhrase)}`;
                
                if (!shareURL.includes('phrase=')) {
                    throw new Error('Share URL generation failed');
                }
                
                // Open test window with sharing context
                const testWindow = openManagedTestWindow(`index.html?phrase=${encodeURIComponent(testPhrase)}`, 'sharing');
                
                const windowStatus = testWindow ? 'opened (auto-closing in 3s)' : 'blocked by popup blocker';
                return `Sharing features available. Native Share: ${hasNativeShare}, Clipboard: ${hasClipboard}. Share URL: "${shareURL}". Live test ${windowStatus}.`;
            });
        }

        function testUIComponents() {
            return executeTest('ui', () => {
                // Note: UI components require phrase input to be visible
                const testPhrase = 'UITest123';
                const testWindow = openManagedTestWindow(`index.html?phrase=${encodeURIComponent(testPhrase)}`, 'ui');
                
                // Test basic DOM functionality
                const testDiv = document.createElement('div');
                testDiv.innerHTML = '<p>Test</p>';
                
                if (!testDiv.querySelector('p')) {
                    throw new Error('DOM manipulation failed');
                }
                
                // Check if CSS variables are working
                const computedStyle = getComputedStyle(document.documentElement);
                const primaryColor = computedStyle.getPropertyValue('--primary');
                
                if (!primaryColor) {
                    throw new Error('CSS variables not working');
                }
                
                const windowStatus = testWindow ? 'opened (auto-closing in 3s)' : 'blocked by popup blocker';
                return `UI rendering functional. DOM manipulation works, CSS variables loaded. Live test with phrase ${windowStatus} - UI components should be visible.`;
            });
        }

        function testPWAFeatures() {
            return executeTest('pwa', () => {
                // Test PWA related features
                const hasServiceWorker = 'serviceWorker' in navigator;
                const hasManifest = document.querySelector('link[rel="manifest"]') !== null;
                
                // Test localStorage
                try {
                    localStorage.setItem('test', 'value');
                    const retrieved = localStorage.getItem('test');
                    localStorage.removeItem('test');
                    
                    if (retrieved !== 'value') {
                        throw new Error('localStorage not working');
                    }
                } catch (e) {
                    throw new Error('localStorage access failed');
                }
                
                return `PWA features checked. Service Worker support: ${hasServiceWorker}, Manifest available: ${hasManifest}, LocalStorage: working.`;
            });
        }

        function testKeyboardShortcuts() {
            return executeTest('keyboard', () => {
                // Test keyboard event handling
                const testEvent = new KeyboardEvent('keydown', {
                    key: 'Enter',
                    ctrlKey: true
                });
                
                if (!testEvent.ctrlKey || testEvent.key !== 'Enter') {
                    throw new Error('Keyboard event creation failed');
                }
                
                // Open test window
                const testWindow = openManagedTestWindow('index.html?phrase=KeyboardTest', 'keyboard');
                
                const windowStatus = testWindow ? 'opened (auto-closing in 3s)' : 'blocked by popup blocker';
                return `Keyboard event handling functional. Test event created successfully. Live test ${windowStatus} for manual keyboard testing.`;
            });
        }        // Quick action functions with enhanced popup management
        function runAllTests() {
            console.log('üöÄ Running all dashboard tests...');
            
            // Check for popup blocker first
            if (!detectAndHandlePopupBlocker()) {
                console.warn('Popup blocker detected, tests may not work properly');
                return;
            }

            // Clean up any existing windows first
            cleanupTestWindows();
              const tests = [
                { name: 'password', func: testPasswordGeneration },
                { name: 'url', func: testURLParameters },
                { name: 'ui', func: testUIComponents },
                { name: 'sharing', func: testSharingFeature },
                { name: 'pwa', func: testPWAFeatures },
                { name: 'keyboard', func: testKeyboardShortcuts },
                { name: 'plugin', func: testPluginManager },
                { name: 'search', func: testAdvancedSearch },
                { name: 'file', func: testFileOperations },
                { name: 'darkmode', func: testDarkModePlugin }
            ];
            
            // Run tests with proper spacing and cleanup
            tests.forEach((test, index) => {
                setTimeout(() => {
                    console.log(`Running test ${index + 1}/${tests.length}: ${test.name}...`);
                    test.func();
                }, index * 800); // Increased delay to prevent too many popups
            });

            // Auto cleanup after all tests complete
            setTimeout(() => {
                console.log('üßπ Auto-cleaning up test windows...');
                cleanupTestWindows();
                
                // Log final results count for debugging
                Object.keys(cardResults).forEach(cardName => {
                    console.log(`üìä ${cardName}: ${cardResults[cardName].length} results`);
                });
            }, tests.length * 800 + 5000); // Cleanup 5 seconds after last test
        }

        function runCoreTests() {
            console.log('‚ö° Running core tests...');
            
            // Check for popup blocker first
            if (!detectAndHandlePopupBlocker()) {
                console.warn('Popup blocker detected, core tests may not work properly');
                return;
            }

            cleanupTestWindows();
            
            setTimeout(testPasswordGeneration, 100);
            setTimeout(testURLParameters, 900);
            setTimeout(testUIComponents, 1700);

            // Auto cleanup after core tests
            setTimeout(() => {
                console.log('üßπ Auto-cleaning up core test windows...');
                cleanupTestWindows();
            }, 7000);
        }

        function runPerformanceTests() {
            console.log('üìä Running performance tests...');
            const start = performance.now();
            
            // Run a series of performance tests
            for (let i = 0; i < 1000; i++) {
                const testArray = new Array(100).fill(0).map((_, i) => i);
                testArray.sort((a, b) => b - a);
            }
            
            const end = performance.now();
            const perfTime = end - start;
            
            document.getElementById('js-time').textContent = `${Math.round(perfTime)}ms (last test)`;
            
            measurePerformanceMetrics();
        }        function clearAllResults() {
            console.log('üóëÔ∏è Clearing all test results...');
            
            // Clean up any open test windows
            cleanupTestWindows();
            
            // Reset all test statuses
            const statusElements = document.querySelectorAll('.test-status');
            statusElements.forEach(element => {
                element.textContent = 'READY';
                element.className = 'test-status pending';
            });
            
            // Clear all result arrays
            cardResults = {
                password: [],
                ui: [],
                sharing: [],
                pwa: [],
                keyboard: [],
                url: []
            };            // Clear all result areas with proper initial messages
            const resultElements = document.querySelectorAll('.test-results');
            resultElements.forEach(element => {
                const testType = element.id.replace('-results', '');
                const messages = {
                    'password': 'Ready to test password generation...',
                    'ui': 'Ready to test UI components...',
                    'sharing': 'Ready to test sharing features...',
                    'pwa': 'Ready to test PWA features...',
                    'keyboard': 'Ready to test keyboard shortcuts...',
                    'url': 'Ready to test URL parameters...'
                };
                // Clear DOM elements and set initial text
                element.innerHTML = '';
                element.textContent = messages[testType] || `Ready to test ${testType}...`;
            });
            
            // Reset test statistics
            testResults = {
                total: 0,
                passed: 0,
                failed: 0,
                times: []
            };
            totalTestsExecuted = 0;
            
            // Reset popup blocker detection
            popupBlockerDetected = false;
            dismissPopupWarning();
            
            updateOverview();
            
            console.log('üßπ All results cleared and dashboard reset');
        }function runInitialHealthCheck() {
            console.log('üè• Running initial health check...');
            
            // Show loading indicator
            document.getElementById('load-time').textContent = 'Checking scripts...';
            
            // Check if all required scripts are loaded (using actual functions that exist)
            const scriptsLoaded = [
                typeof CIPHER_CONFIG !== 'undefined',
                typeof applyCipherTransform === 'function',
                typeof substitutions === 'object'
            ];
            
            const scriptNames = ['CIPHER_CONFIG', 'applyCipherTransform', 'substitutions'];
            const allScriptsLoaded = scriptsLoaded.every(Boolean);
            
            console.log('üìã Script check results:');
            scriptsLoaded.forEach((loaded, index) => {
                console.log(`  ${loaded ? '‚úÖ' : '‚ùå'} ${scriptNames[index]}: ${loaded ? 'loaded' : 'missing'}`);
            });
            
            if (allScriptsLoaded) {
                console.log('‚úÖ All core scripts loaded successfully');
                document.getElementById('load-time').textContent = 'Scripts loaded ‚úÖ';
                
                // Show auto-test countdown
                let countdown = 2;
                const countdownInterval = setInterval(() => {
                    document.getElementById('js-time').textContent = `Auto-tests in ${countdown}s...`;
                    countdown--;
                    if (countdown < 0) {
                        clearInterval(countdownInterval);
                        document.getElementById('js-time').textContent = 'Tests starting...';
                    }
                }, 1000);
            } else {
                console.warn('‚ö†Ô∏è Some scripts may not be loaded');
                document.getElementById('load-time').textContent = 'Script issues ‚ö†Ô∏è';
                document.getElementById('js-time').textContent = 'Manual testing only';
                
                // Still try auto-tests but with warning
                setTimeout(() => {
                    document.getElementById('js-time').textContent = 'Testing with warnings...';
                }, 2000);
            }        }
        
        function runAdvancedFeatureTests() {
            console.log('üöÄ Running advanced feature tests...');
            
            const advancedTests = [
                { name: 'plugin', func: testPluginManager },
                { name: 'search', func: testAdvancedSearch },
                { name: 'file', func: testFileOperations },
                { name: 'darkmode', func: testDarkModePlugin }
            ];
            
            // Run advanced tests with spacing
            advancedTests.forEach((test, index) => {
                setTimeout(() => {
                    console.log(`Running advanced test ${index + 1}/${advancedTests.length}: ${test.name}...`);
                    test.func();
                }, index * 500);
            });
            
            modernAlert('üöÄ Running advanced feature tests', 'info');
        }

        // ==============================================
        // ADVANCED FEATURES TESTS
        // ==============================================
        
        function testPluginManager() {
            const startTime = performance.now();
            updateTestStatus('plugin-status', 'TESTING');
            console.log('üß© Testing Plugin Manager...');
            
            try {
                let results = [];
                
                // Test 1: Check if plugin manager is loaded
                if (typeof PluginManager !== 'undefined') {
                    results.push('‚úÖ Plugin Manager loaded');
                } else {
                    results.push('‚ùå Plugin Manager not loaded');
                }
                
                // Test 2: Check plugin registration
                if (typeof PluginManager !== 'undefined' && PluginManager.getRegisteredPlugins) {
                    const plugins = PluginManager.getRegisteredPlugins();
                    results.push(`‚úÖ Found ${plugins.length} registered plugins`);
                } else {
                    results.push('‚ùå Plugin registration check failed');
                }
                
                // Test 3: Check modal functionality
                if (typeof openPluginManager === 'function') {
                    results.push('‚úÖ Plugin manager UI function available');
                } else {
                    results.push('‚ùå Plugin manager UI function missing');
                }
                
                const endTime = performance.now();
                recordTestResult('plugin', true, endTime - startTime);
                updateTestStatus('plugin-status', 'PASSED');
                updateTestResults('plugin-results', results.join('<br>'));
                
            } catch (error) {
                const endTime = performance.now();
                recordTestResult('plugin', false, endTime - startTime);
                updateTestStatus('plugin-status', 'FAILED');
                updateTestResults('plugin-results', `‚ùå Plugin Manager test failed: ${error.message}`);
                console.error('Plugin Manager test error:', error);
            }
        }
        
        function testAdvancedSearch() {
            const startTime = performance.now();
            updateTestStatus('search-status', 'TESTING');
            console.log('üîç Testing Advanced Search...');
            
            try {
                let results = [];
                
                // Test 1: Check if advanced search is loaded
                if (typeof AdvancedSearch !== 'undefined') {
                    results.push('‚úÖ Advanced Search loaded');
                } else {
                    results.push('‚ùå Advanced Search not loaded');
                }
                
                // Test 2: Check search functionality
                if (typeof openAdvancedSearch === 'function') {
                    results.push('‚úÖ Advanced Search UI function available');
                } else {
                    results.push('‚ùå Advanced Search UI function missing');
                }
                
                // Test 3: Check modal element
                const modal = document.getElementById('advancedSearchModal');
                if (modal) {
                    results.push('‚úÖ Advanced Search modal found');
                } else {
                    results.push('‚ùå Advanced Search modal missing');
                }
                
                const endTime = performance.now();
                recordTestResult('search', true, endTime - startTime);
                updateTestStatus('search-status', 'PASSED');
                updateTestResults('search-results', results.join('<br>'));
                
            } catch (error) {
                const endTime = performance.now();
                recordTestResult('search', false, endTime - startTime);
                updateTestStatus('search-status', 'FAILED');
                updateTestResults('search-results', `‚ùå Advanced Search test failed: ${error.message}`);
                console.error('Advanced Search test error:', error);
            }
        }
        
        function testFileOperations() {
            const startTime = performance.now();
            updateTestStatus('file-status', 'TESTING');
            console.log('üìÅ Testing File Operations...');
            
            try {
                let results = [];
                
                // Test 1: Check if file operations is loaded
                if (typeof FileOperations !== 'undefined') {
                    results.push('‚úÖ File Operations loaded');
                } else {
                    results.push('‚ùå File Operations not loaded');
                }
                
                // Test 2: Check file operations functionality
                if (typeof openFileOperations === 'function') {
                    results.push('‚úÖ File Operations UI function available');
                } else {
                    results.push('‚ùå File Operations UI function missing');
                }
                
                // Test 3: Check modal element
                const modal = document.getElementById('fileOperationsModal');
                if (modal) {
                    results.push('‚úÖ File Operations modal found');
                } else {
                    results.push('‚ùå File Operations modal missing');
                }
                
                const endTime = performance.now();
                recordTestResult('file', true, endTime - startTime);
                updateTestStatus('file-status', 'PASSED');
                updateTestResults('file-results', results.join('<br>'));
                
            } catch (error) {
                const endTime = performance.now();
                recordTestResult('file', false, endTime - startTime);
                updateTestStatus('file-status', 'FAILED');
                updateTestResults('file-results', `‚ùå File Operations test failed: ${error.message}`);
                console.error('File Operations test error:', error);
            }
        }
        
        function testDarkModePlugin() {
            const startTime = performance.now();
            updateTestStatus('darkmode-status', 'TESTING');
            console.log('üåô Testing Dark Mode Plugin...');
            
            try {
                let results = [];
                
                // Test 1: Check if dark mode plugin is loaded
                if (typeof DarkModePlugin !== 'undefined') {
                    results.push('‚úÖ Dark Mode Plugin loaded');
                } else {
                    results.push('‚ùå Dark Mode Plugin not loaded');
                }
                
                // Test 2: Check if plugin is registered
                if (typeof PluginManager !== 'undefined' && PluginManager.getRegisteredPlugins) {
                    const plugins = PluginManager.getRegisteredPlugins();
                    const darkModePlugin = plugins.find(p => p.id === 'dark-mode-plugin');
                    if (darkModePlugin) {
                        results.push('‚úÖ Dark Mode Plugin registered');
                    } else {
                        results.push('‚ùå Dark Mode Plugin not registered');
                    }
                } else {
                    results.push('‚ö†Ô∏è Plugin Manager not available for registration check');
                }
                
                // Test 3: Check theme functionality
                if (typeof toggleDarkModePlugin === 'function') {
                    results.push('‚úÖ Dark Mode toggle function available');
                } else {
                    results.push('‚ùå Dark Mode toggle function missing');
                }
                
                const endTime = performance.now();
                recordTestResult('darkmode', true, endTime - startTime);
                updateTestStatus('darkmode-status', 'PASSED');
                updateTestResults('darkmode-results', results.join('<br>'));
                
            } catch (error) {
                const endTime = performance.now();
                recordTestResult('darkmode', false, endTime - startTime);
                updateTestStatus('darkmode-status', 'FAILED');
                updateTestResults('darkmode-results', `‚ùå Dark Mode Plugin test failed: ${error.message}`);
                console.error('Dark Mode Plugin test error:', error);
            }
        }

        function toggleDarkModePlugin() {
            if (typeof PluginManager !== 'undefined' && PluginManager.executeHook) {
                PluginManager.executeHook('theme.toggle');
                modernAlert('üåô Dark mode toggled', 'info');
            } else {
                modernAlert('‚ùå Plugin Manager not available', 'error');
            }
        }

        // Helper functions
        function openTestUrl(params) {
            const url = `index.html${params}`;
            console.log(`üîó Opening test URL: ${url}`);
            return openManagedTestWindow(url, 'manual');
        }        // Manual test function for debugging result appending
        function runManualAppendTest() {
            console.log('üß™ Running manual append test...');
            console.log('üìã This will run the password test 3 times with 1 second intervals');
            console.log('üëÄ Watch the password generation card - it should show 3 results');
            
            // Clear the password results first
            if (cardResults.password) {
                cardResults.password = [];
                updateCardResultsDisplay('password');
            }
            
            // Run the same test multiple times to verify appending
            setTimeout(() => {
                console.log('üîÑ Running test 1/3...');
                testPasswordGeneration();
            }, 100);
            
            setTimeout(() => {
                console.log('üîÑ Running test 2/3...');
                testPasswordGeneration();
            }, 1100);
            
            setTimeout(() => {
                console.log('üîÑ Running test 3/3...');
                testPasswordGeneration();
            }, 2100);
            
            setTimeout(() => {
                console.log('ÔøΩ Final check - password results count:', cardResults.password ? cardResults.password.length : 0);
                console.log('üìã Full password results:', cardResults.password);
            }, 3000);
        }

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error detected:', event.error);
            testResults.total++;
            testResults.failed++;
            updateOverview();
        });

        // Window cleanup on page unload
        window.addEventListener('beforeunload', () => {
            cleanupTestWindows();
        });

        // Add CSS for slideOut animation
        const additionalStyle = document.createElement('style');
        additionalStyle.textContent = `
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(additionalStyle);

        // Global functions for popup warning (need to be accessible from HTML)
        window.enablePopupsAndRetry = enablePopupsAndRetry;
        window.dismissPopupWarning = dismissPopupWarning;
        window.runManualAppendTest = runManualAppendTest;

        console.log('üîß Developer Dashboard loaded and ready');
    </script>
</body>
</html>
